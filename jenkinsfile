pipeline{
  agent any
  triggers {
  cron('0 06 * * *')
  }
  stages{
    stage("code checkout"){
      steps{
      bat "echo hello"
      }
    }
    stage("code build"){
        steps{
          bat "mvn clean"
        }
      }  
       stage("code test"){
          steps{
          bat "mvn test"
        }
      }
        stage("SonarQube analysis") {
          steps{
          withSonarQubeEnv("sonar_local") {
          mvn clean verify sonar:sonar \
          -Dsonar.projectKey=sonarqubetest \
          -Dsonar.projectName='sonarqubetest' \
          -Dsonar.host.url=http://localhost:9000 \
          -Dsonar.token=sqp_ce896adba5d8f772a25e9e5da4327ecf0c3d5a61
        }
    }
}
      stage("Publish to Artifactory"){
        steps{
              rtMavenDeployer(
                  id: 'deployer',
                  serverId:'nagp@govinda',
                  releaseRepo:'govinda1988',
                  snapshotRepo:'govinda1988',
                )
              rtMavenRun(
                  pom: 'pom.xml',
                  goals:'clean install',
                  deployerId:'deployer'
              )
              rtPublishBuildInfo(
                  serverId:'nagp@govinda',
              )
            }
              
      }
      
      
}
post {
    success{
        bat "echo success"
            }
      }
}
  

  
